<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Ajax | 你的名字</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="持续学习那些不变的底层知识">
    <link rel="preload" href="/assets/css/0.styles.cf364661.css" as="style"><link rel="preload" href="/assets/js/app.37a344aa.js" as="script"><link rel="preload" href="/assets/js/3.27823f6c.js" as="script"><link rel="preload" href="/assets/js/1.cc6167c7.js" as="script"><link rel="preload" href="/assets/js/17.ba0d4562.js" as="script"><link rel="prefetch" href="/assets/js/10.4fc031af.js"><link rel="prefetch" href="/assets/js/11.e3772f3e.js"><link rel="prefetch" href="/assets/js/12.b31c219d.js"><link rel="prefetch" href="/assets/js/13.a43e0022.js"><link rel="prefetch" href="/assets/js/14.d72f4213.js"><link rel="prefetch" href="/assets/js/15.bcb8d2c6.js"><link rel="prefetch" href="/assets/js/16.4b891440.js"><link rel="prefetch" href="/assets/js/18.70ef9823.js"><link rel="prefetch" href="/assets/js/19.8fa29ce1.js"><link rel="prefetch" href="/assets/js/20.3935a720.js"><link rel="prefetch" href="/assets/js/21.cecaea6f.js"><link rel="prefetch" href="/assets/js/22.7825612a.js"><link rel="prefetch" href="/assets/js/23.bea3b71f.js"><link rel="prefetch" href="/assets/js/24.758aab56.js"><link rel="prefetch" href="/assets/js/25.2f984301.js"><link rel="prefetch" href="/assets/js/26.91717f84.js"><link rel="prefetch" href="/assets/js/27.3bab334b.js"><link rel="prefetch" href="/assets/js/28.47ce6f2a.js"><link rel="prefetch" href="/assets/js/29.5b34be08.js"><link rel="prefetch" href="/assets/js/30.67a38d00.js"><link rel="prefetch" href="/assets/js/31.e68df368.js"><link rel="prefetch" href="/assets/js/32.955a9acb.js"><link rel="prefetch" href="/assets/js/33.67f713ca.js"><link rel="prefetch" href="/assets/js/34.9827b998.js"><link rel="prefetch" href="/assets/js/35.0c08c34a.js"><link rel="prefetch" href="/assets/js/36.1fafef03.js"><link rel="prefetch" href="/assets/js/37.a09721b8.js"><link rel="prefetch" href="/assets/js/38.80a6d3fe.js"><link rel="prefetch" href="/assets/js/39.d7e39752.js"><link rel="prefetch" href="/assets/js/4.c5dc9af6.js"><link rel="prefetch" href="/assets/js/40.c1427058.js"><link rel="prefetch" href="/assets/js/41.f48a2aa1.js"><link rel="prefetch" href="/assets/js/42.268c65ef.js"><link rel="prefetch" href="/assets/js/43.f5bbe7ab.js"><link rel="prefetch" href="/assets/js/44.bb9e88b1.js"><link rel="prefetch" href="/assets/js/45.f11ff196.js"><link rel="prefetch" href="/assets/js/46.8a0134aa.js"><link rel="prefetch" href="/assets/js/47.8ab35044.js"><link rel="prefetch" href="/assets/js/48.d7977d49.js"><link rel="prefetch" href="/assets/js/49.6761377d.js"><link rel="prefetch" href="/assets/js/5.53ecbcea.js"><link rel="prefetch" href="/assets/js/50.9401224f.js"><link rel="prefetch" href="/assets/js/51.55ba23e7.js"><link rel="prefetch" href="/assets/js/52.28d0356d.js"><link rel="prefetch" href="/assets/js/53.e22fa6fb.js"><link rel="prefetch" href="/assets/js/54.6b190cf3.js"><link rel="prefetch" href="/assets/js/55.1393bf52.js"><link rel="prefetch" href="/assets/js/6.d943a739.js"><link rel="prefetch" href="/assets/js/7.c9cdceb6.js"><link rel="prefetch" href="/assets/js/8.45f2fa75.js"><link rel="prefetch" href="/assets/js/9.7f603727.js">
    <link rel="stylesheet" href="/assets/css/0.styles.cf364661.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-dad8a512><div data-v-dad8a512><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-dad8a512 data-v-dad8a512><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-64685f0e data-v-dad8a512 data-v-dad8a512><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e>你的名字</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>Duke Shao</span>
            
          <span data-v-64685f0e>2017 - </span>
          2020
        </a></span></div></div> <div class="hide" data-v-dad8a512><header class="navbar" data-v-dad8a512><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/head.png" alt="你的名字" class="logo"> <span class="site-name">你的名字</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/B_Javascript/" class="nav-link"><i class="iconfont undefined"></i>
  B_Javascript
</a></li><li class="dropdown-item"><!----> <a href="/categories/A_HTML+CSS/" class="nav-link"><i class="iconfont undefined"></i>
  A_HTML+CSS
</a></li><li class="dropdown-item"><!----> <a href="/categories/C_Typescript/" class="nav-link"><i class="iconfont undefined"></i>
  C_Typescript
</a></li><li class="dropdown-item"><!----> <a href="/categories/D_AngularJS/" class="nav-link"><i class="iconfont undefined"></i>
  D_AngularJS
</a></li><li class="dropdown-item"><!----> <a href="/categories/G_Git/" class="nav-link"><i class="iconfont undefined"></i>
  G_Git
</a></li><li class="dropdown-item"><!----> <a href="/categories/J_加密解密/" class="nav-link"><i class="iconfont undefined"></i>
  J_加密解密
</a></li><li class="dropdown-item"><!----> <a href="/categories/K_浏览器兼容/" class="nav-link"><i class="iconfont undefined"></i>
  K_浏览器兼容
</a></li><li class="dropdown-item"><!----> <a href="/categories/L_Webpack/" class="nav-link"><i class="iconfont undefined"></i>
  L_Webpack
</a></li><li class="dropdown-item"><!----> <a href="/categories/M_服务器部署/" class="nav-link"><i class="iconfont undefined"></i>
  M_服务器部署
</a></li><li class="dropdown-item"><!----> <a href="/categories/N_MAC使用/" class="nav-link"><i class="iconfont undefined"></i>
  N_MAC使用
</a></li><li class="dropdown-item"><!----> <a href="/categories/H_Docker/" class="nav-link"><i class="iconfont undefined"></i>
  H_Docker
</a></li><li class="dropdown-item"><!----> <a href="/categories/I_Hexo博客/" class="nav-link"><i class="iconfont undefined"></i>
  I_Hexo博客
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-dad8a512></div> <aside class="sidebar" data-v-dad8a512><div class="personal-info-wrapper" data-v-ca798c94 data-v-dad8a512><img src="/head.png" alt="author-avatar" class="personal-img" data-v-ca798c94> <h3 class="name" data-v-ca798c94>
    Duke Shao
  </h3> <div class="num" data-v-ca798c94><div data-v-ca798c94><h3 data-v-ca798c94>42</h3> <h6 data-v-ca798c94>Article</h6></div> <div data-v-ca798c94><h3 data-v-ca798c94>24</h3> <h6 data-v-ca798c94>Tag</h6></div></div> <hr data-v-ca798c94></div> <nav class="nav-links"><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/B_Javascript/" class="nav-link"><i class="iconfont undefined"></i>
  B_Javascript
</a></li><li class="dropdown-item"><!----> <a href="/categories/A_HTML+CSS/" class="nav-link"><i class="iconfont undefined"></i>
  A_HTML+CSS
</a></li><li class="dropdown-item"><!----> <a href="/categories/C_Typescript/" class="nav-link"><i class="iconfont undefined"></i>
  C_Typescript
</a></li><li class="dropdown-item"><!----> <a href="/categories/D_AngularJS/" class="nav-link"><i class="iconfont undefined"></i>
  D_AngularJS
</a></li><li class="dropdown-item"><!----> <a href="/categories/G_Git/" class="nav-link"><i class="iconfont undefined"></i>
  G_Git
</a></li><li class="dropdown-item"><!----> <a href="/categories/J_加密解密/" class="nav-link"><i class="iconfont undefined"></i>
  J_加密解密
</a></li><li class="dropdown-item"><!----> <a href="/categories/K_浏览器兼容/" class="nav-link"><i class="iconfont undefined"></i>
  K_浏览器兼容
</a></li><li class="dropdown-item"><!----> <a href="/categories/L_Webpack/" class="nav-link"><i class="iconfont undefined"></i>
  L_Webpack
</a></li><li class="dropdown-item"><!----> <a href="/categories/M_服务器部署/" class="nav-link"><i class="iconfont undefined"></i>
  M_服务器部署
</a></li><li class="dropdown-item"><!----> <a href="/categories/N_MAC使用/" class="nav-link"><i class="iconfont undefined"></i>
  N_MAC使用
</a></li><li class="dropdown-item"><!----> <a href="/categories/H_Docker/" class="nav-link"><i class="iconfont undefined"></i>
  H_Docker
</a></li><li class="dropdown-item"><!----> <a href="/categories/I_Hexo博客/" class="nav-link"><i class="iconfont undefined"></i>
  I_Hexo博客
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-64685f0e data-v-dad8a512><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e>Ajax</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>Duke Shao</span>
            
          <span data-v-64685f0e>2017 - </span>
          2020
        </a></span></div></div> <div data-v-dad8a512><main class="page"><div class="page-title" style="display:none;"><h1>Ajax</h1> <hr> <div data-v-aa64b9d0><i class="iconfont reco-account" data-v-aa64b9d0><span data-v-aa64b9d0>Duke Shao</span></i> <i class="iconfont reco-date" data-v-aa64b9d0><span data-v-aa64b9d0>2015-10-06 23:18:33</span></i> <!----> <i class="iconfont reco-tag tags" data-v-aa64b9d0><span class="tag-item" data-v-aa64b9d0>Javascript</span></i></div></div> <div class="theme-reco-content content__default" style="display:none;"><h2 id="一、概念"><a href="#一、概念" class="header-anchor">#</a> 一、概念</h2> <div class="language- extra-class"><pre class="language-text"><code>1.AJAX
	Asynchronous Javascript And Xml，Ajax 技术的核心是XMLHttpRequest对象（简称XHR），这是由微软首先引入的一个特性，其他浏览器提供商后来都提供了相同的实现

2.起源
	最早出现在2005年的google搜索建议
3.优点
	* 增加速度：减轻服务器的负担,按需加载数据,最大程度的减少冗余请求
	* 改善的用户体验：局部刷新页面,减少用户等待时间,带来更好的用户体验
	* 页面和数据分离：前后端分离，操作更灵活，后期维护更方便
4.后端语言和服务器配置
	* php + Apache + mySQL
	* NodeJS + MongoDB
	* Java + tomcat + Oracle
	* .NET + IIS + SQL Server
</code></pre></div><h2 id="二、json"><a href="#二、json" class="header-anchor">#</a> 二、json</h2> <h3 id="_1-json数据-json字符串"><a href="#_1-json数据-json字符串" class="header-anchor">#</a> 1.json数据(json字符串)</h3> <div class="language- extra-class"><pre class="language-text"><code>{&quot;id&quot; : 21465461461461, &quot;name&quot;: &quot;张三&quot;},[{&quot;id&quot; : 21465461461461, &quot;name&quot;: &quot;张三&quot;}]
</code></pre></div><h3 id="_2-json字符串与对象的转换"><a href="#_2-json字符串与对象的转换" class="header-anchor">#</a> 2.json字符串与对象的转换</h3> <div class="language- extra-class"><pre class="language-text"><code>1.json字符串转成对象的转换
(1)eval(&quot;(&quot;+json字符串+&quot;)&quot;); 
	它的作用是，将一个普通的json格式(不标准的json字符串)的字符串，转换成Json格式的对象
	var list = eval(&quot;(&quot;+request.responseText+&quot;)&quot;);
(2)JSON.parse(); //把JSON字符串转成JSON对象(js对象/数组)【es5】
2.把JSON对象转成JSON字符串
	JSON.stringify(); 
</code></pre></div><h3 id="_3-json文件存在的意义"><a href="#_3-json文件存在的意义" class="header-anchor">#</a> 3.json文件存在的意义</h3> <div class="language- extra-class"><pre class="language-text"><code>//模拟数据(与后端先商量)
[
	{
		&quot;id&quot;:&quot;G001&quot;,
		&quot;name&quot;:&quot;Thermos 膳魔师 Funtainer系列水杯 12盎司（340g） 粉红色&quot;,
		&quot;imgurl&quot;:&quot;images/g1.jpg&quot;,
		&quot;price&quot;:899,
	}
]
</code></pre></div><h2 id="三、ajax请求步骤"><a href="#三、ajax请求步骤" class="header-anchor">#</a> 三、Ajax请求步骤</h2> <p>1.创建请求对象</p> <div class="language- extra-class"><pre class="language-text"><code>var xhr = new XMLHttpRequest();//返回一个异步请求对象
</code></pre></div><p>2.处理服务器返回数据</p> <div class="language- extra-class"><pre class="language-text"><code>xhr.onreadystatechange = function(){
    if(xhr.readyState == 4) {
        //responseText：保存服务器返回的数据（从服务器返回的数据是“字符串”）。
        alert(xhr.responseText);
    }
}
</code></pre></div><p>3.设置请求参数,建立与服务器的连接</p> <div class="language- extra-class"><pre class="language-text"><code>xhr.open(&quot;get&quot;, &quot;http://localhost/api/ajaxtest&quot;, true);
</code></pre></div><p>4.向服务器发送请求</p> <div class="language- extra-class"><pre class="language-text"><code>xhr.send(null);
</code></pre></div><h2 id="四、xmlhttprequest"><a href="#四、xmlhttprequest" class="header-anchor">#</a> 四、XMLHttpRequest</h2> <h3 id="_1-open-type-url-async"><a href="#_1-open-type-url-async" class="header-anchor">#</a> 1.open(type,url,async)</h3> <p>open(type,url（同源策略）,async（同步、异步）)</p> <div class="language- extra-class"><pre class="language-text"><code>1.open(type,url,async): 建立与服务器的连接
    type：请求的类型，get获取、post发送
    	* 区别? 
    		get请求数据接在url后面，post请求数据通过send方法传递
    		get传递的数据会比较少，post没有限制
    		get传递的数据会暴露出来
    url：数据请求的地址（API地址），一般由后端开发人员提供
    	* 相对路径的情况下，必须在同一个根目录(端口配置的目录)下。
        * 当前页面访问地址，API地址两者一定要同域
        * 同域（同源策略）：协议，域名，端口三者一致
        * 报错： No 'Access-Control-Allow-Origin' header is present on the requested resource. Origin 'null' is therefore not allowed access.
	async：是否异步发送请求（true,false），默认为true
        * 同步：按步骤顺序执行，前面的代码执行完后，后面的代码才会执行
        	做完前一件事情, 才能下一件事情（排队）
        * 异步：与其他操作同时执行，也叫并发（图片加载，ajax请求，定时器）
</code></pre></div><h3 id="_2-send-data"><a href="#_2-send-data" class="header-anchor">#</a> 2.send(data)</h3> <div class="language- extra-class"><pre class="language-text"><code>2.send(data): 向服务器发送请求
	data：可选参数，post请求时才生效，表示发请求时传送的数据字符串。
    	 xhr.send('size=20&amp;type=music');
		在某些浏览器中，如果不需要通过post请求主体发送数据，则必须传入null
//备注：get请求的数据写在url地址后
	request.open(&quot;get&quot;, &quot;http://localhost/api/getdata.php?type=get&amp;qty=10&quot;, true);
	setRequestHeader(key,val)：设置请求头
//备注：利用请求头设置POST提交数据格式(form表单)：
	xhr.setRequestHeader('content-type','application/x-www-form-urlencoded');//open方法后设置
</code></pre></div><p>在请求收到服务器的响应后，响应的数据会自动填充xhr 对象的属性，相关的属性简介如下</p> <h3 id="_3-readystate"><a href="#_3-readystate" class="header-anchor">#</a> 3.readyState</h3> <div class="language- extra-class"><pre class="language-text"><code>0 － （未初始化）尚未调用open()方法。
1 － （启动）已经调用open()方法，但尚未调用send()方法。
2 － （发送）send()方法执行完成，但尚未接收到响应。
3 － （接收）已经接收到部分响应数据。
4 － （完成）响应内容解析完成，可以在客户端调用了
只要readyState 属性的值由一个值变成另一个值，都会触发一次readystatechange 事件。必须在调用open()之前指定onreadystatechange事件处理程序才能确保跨浏览器兼容性。
</code></pre></div><h3 id="_4-responsetext"><a href="#_4-responsetext" class="header-anchor">#</a> 4.responseText</h3> <p>保存服务器返回的数据（从服务器返回的数据是“字符串”）。</p> <h3 id="_5-status"><a href="#_5-status" class="header-anchor">#</a> 5.status</h3> <div class="language- extra-class"><pre class="language-text"><code>* 响应的HTTP 状态。
200（OK）：服务器成功返回了页面
304（Not Modified）：数据与服务器相同，不需要重服务器请求（直接使用缓存的数据）
400（Bad Request）：语法错误导致服务器不识别
401（Unauthorized）：请求需要用户认证
404（Not found）：请求地址不存在
500（Internal Server Error）：服务器出错或无响应
503（ServiceUnavailable）：由于服务器过载或维护导致无法完
</code></pre></div><h2 id="五、跨域解决方案"><a href="#五、跨域解决方案" class="header-anchor">#</a> 五、跨域解决方案</h2> <h3 id="_1-jsonp"><a href="#_1-jsonp" class="header-anchor">#</a> 1.JSONP</h3> <p>原理：利用script标签能加载其他域名的js文件的原理,实现跨域数据请求</p> <div class="language- extra-class"><pre class="language-text"><code>* JSONP 是JSON with padding（填充式JSON 或参数式JSON）的简写。
* JSONP是一种可以绕过浏览器的安全限制，从不同的域请求数据的方法。
* JSONP请求不是ajax请求，是利用script标签能加载其他域名的js文件的原理，来实现跨域数据的请求 
* 局限性：
  - 只能为get请求
  - 接口必须有回调函数的执行
</code></pre></div><p>案例练习1：使用script标签其他js文件调用本地js的某个函数;</p> <p>案例练习2：使用script标签其他php文件调用本地js的未知名方法，返回数据</p> <p>案例练习3：利用JSONP原理调用百度建议</p> <div class="language- extra-class"><pre class="language-text"><code>msg.oninput = function(){
    let _msg = msg.value;
    clearTimeout(timer);
    timer = setTimeout(()=&gt;{
    let script = document.createElement('script');
    script.src='https://sp0.baidu.com/5a1Fazu8AA54nxGko9WTAnF6hhy/sujson=1&amp;cb=getData&amp;wd='+_msg;
    document.body.appendChild(script);
    },500);
}
window.getData = function(data){
    suggest.innerHTML = data.s.map(item=&gt;{
        return `&lt;li&gt;${item}&lt;/li&gt;`
        }).join(&quot;&quot;);
    }
})
//原理性代码：
//1.script的src中回调函数的传递
script.src='https://sp0.baidu.com/5a1Fazu8AA54nxGko9WTAnF6hhy/sujson=1&amp;cb=getData&amp;wd='+_msg;
//2.声明全局函数
window.getData = function(data){处理数据}
</code></pre></div><h3 id="_2-cors"><a href="#_2-cors" class="header-anchor">#</a> 2.CORS</h3> <p>原理：在后端响应头添加词字段header('Access-Control-Allow-Origin: *')</p> <div class="language- extra-class"><pre class="language-text"><code>CORS是一个W3C标准，全称是”跨域资源共享”（Cross-origin resource sharing），它允许浏览器向跨源服务器发出XMLHttpRequest请求，从而克服了AJAX只能同源使用的限制。

CORS需要浏览器和服务器同时支持。目前，所有浏览器都支持该功能，IE浏览器不能低于IE10。服务器需要设置响应头，允许该域名访问
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>1.Access-Control-Allow-Origin
	header('Access-Control-Allow-Origin: *');  
该字段是必须的。需要在后端响应头添加词字段，值要么是一个*，表示接受任意域名的请求，要么指定一个域名http://localhost。
2.Access-Control-Allow-Methods
3.Access-Control-Allow-Headers
    header('Access-Control-Allow-Methods:POST');  
    header('Access-Control-Allow-Headers:x-requested-with,content-type'); 
</code></pre></div><p>案例1：天气预报</p> <p>案例2：百度地图</p> <h3 id="_3-服务器代理"><a href="#_3-服务器代理" class="header-anchor">#</a> 3.服务器代理</h3> <p>原理：file_get_contents($url) //获取网站内容</p> <p>后端不存在跨域问题，所以可以利用后端间接获取其他网站的数据</p> <div class="language- extra-class"><pre class="language-text"><code>ajax跨域请求之服务端代理（爬虫）
原理：获取页面所有内容，并利用正则匹配所需内容
file_get_contents($url) //获取网站内容
preg_match_all($reg,$str,$res) 
preg_match($reg,$str,$res)   //$str代表被匹配的内容，$res为结果
$content = iconv(原字符编码,新字符编码,$content);//修改$content字符编码
</code></pre></div><p>案例1：利用服务器代理获取外网IP</p> <p>案例2：根据IP获取所在城市（ajax嵌套）</p> <p>案例3：根据城市获取天气预报（ajax嵌套）</p> <p>案例4：POST请求数据</p> <h2 id="六、异步处理方法promise"><a href="#六、异步处理方法promise" class="header-anchor">#</a> 六、异步处理方法Promise</h2> <h3 id="_1-promise"><a href="#_1-promise" class="header-anchor">#</a> 1.Promise</h3> <p>Promise是一个构造函数，所谓的Promise对象，就是通过new Promise()实例化得到的对象，用来传递异步操作的数据。它代表了某个未来才会知道结果的事件（通常是一个异步操作），并且这个事件提供统一的 API，可供进一步处理。</p> <p>1.创建对象</p> <div class="language- extra-class"><pre class="language-text"><code>var p=new Promise(function(resolve,reject){
    //成功拿到数据执行resolve,失败执行reject
})
	*规定好了哪个阶段执行哪个函数
Promise的三种状态
    * Pending(未完成)可以理解为Promise对象实例new创建时候的初始状态
    * Resolved(成功)可以理解成功的状态
    * Rejected(失败)可以理解为失败的状态
</code></pre></div><p>2.执行方法</p> <div class="language- extra-class"><pre class="language-text"><code>p.then(成功时要执行的代码).catch(失败时执行的代码)
</code></pre></div><p>3.静态方法</p> <p>Promise.all([p1,p2,p3,p4])</p> <p>将多个Promise实例,包装成一个新的Promise实例</p> <p>所有参数中的Promise状态都为resolved时,新的promise状态才为resolved</p> <p>只要p1,p2,p3...之中有一个被rejected,新的promise的状态就变成rejected</p> <div class="language- extra-class"><pre class="language-text"><code>Promise.all([p1,p2,p3]).then(function(res){
	console.log(res);
})
</code></pre></div><p>Promise.race([p1,p2,p3...]) 竞速,完成一个即可</p> <h3 id="_2-try-catch"><a href="#_2-try-catch" class="header-anchor">#</a> 2.try...catch</h3> <p>尝试执行代码,如果有错误则执行catch捕获错误(不报错)</p> <div class="language- extra-class"><pre class="language-text"><code>try{
	console.log(666)
	//先尝试执行这里的代码
	show();
	//无报错，则忽略catch
	//如果报错，则执行catch，并传递错误信息
}catch(error){
	console.log(error)
}
console.log('end');
</code></pre></div></div> <footer class="page-edit" style="display:none;"><!----> <!----></footer> <!----> <!----> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-40a3448a><li class="level-2" data-v-40a3448a><a href="/B_Javascript/60_Ajax.html#一、概念" class="sidebar-link" data-v-40a3448a>一、概念</a></li><li class="level-2" data-v-40a3448a><a href="/B_Javascript/60_Ajax.html#二、json" class="sidebar-link" data-v-40a3448a>二、json</a></li><li class="level-3" data-v-40a3448a><a href="/B_Javascript/60_Ajax.html#_1-json数据-json字符串" class="sidebar-link" data-v-40a3448a>1.json数据(json字符串)</a></li><li class="level-3" data-v-40a3448a><a href="/B_Javascript/60_Ajax.html#_2-json字符串与对象的转换" class="sidebar-link" data-v-40a3448a>2.json字符串与对象的转换</a></li><li class="level-3" data-v-40a3448a><a href="/B_Javascript/60_Ajax.html#_3-json文件存在的意义" class="sidebar-link" data-v-40a3448a>3.json文件存在的意义</a></li><li class="level-2" data-v-40a3448a><a href="/B_Javascript/60_Ajax.html#三、ajax请求步骤" class="sidebar-link" data-v-40a3448a>三、Ajax请求步骤</a></li><li class="level-2" data-v-40a3448a><a href="/B_Javascript/60_Ajax.html#四、xmlhttprequest" class="sidebar-link" data-v-40a3448a>四、XMLHttpRequest</a></li><li class="level-3" data-v-40a3448a><a href="/B_Javascript/60_Ajax.html#_1-open-type-url-async" class="sidebar-link" data-v-40a3448a>1.open(type,url,async)</a></li><li class="level-3" data-v-40a3448a><a href="/B_Javascript/60_Ajax.html#_2-send-data" class="sidebar-link" data-v-40a3448a>2.send(data)</a></li><li class="level-3" data-v-40a3448a><a href="/B_Javascript/60_Ajax.html#_3-readystate" class="sidebar-link" data-v-40a3448a>3.readyState</a></li><li class="level-3" data-v-40a3448a><a href="/B_Javascript/60_Ajax.html#_4-responsetext" class="sidebar-link" data-v-40a3448a>4.responseText</a></li><li class="level-3" data-v-40a3448a><a href="/B_Javascript/60_Ajax.html#_5-status" class="sidebar-link" data-v-40a3448a>5.status</a></li><li class="level-2" data-v-40a3448a><a href="/B_Javascript/60_Ajax.html#五、跨域解决方案" class="sidebar-link" data-v-40a3448a>五、跨域解决方案</a></li><li class="level-3" data-v-40a3448a><a href="/B_Javascript/60_Ajax.html#_1-jsonp" class="sidebar-link" data-v-40a3448a>1.JSONP</a></li><li class="level-3" data-v-40a3448a><a href="/B_Javascript/60_Ajax.html#_2-cors" class="sidebar-link" data-v-40a3448a>2.CORS</a></li><li class="level-3" data-v-40a3448a><a href="/B_Javascript/60_Ajax.html#_3-服务器代理" class="sidebar-link" data-v-40a3448a>3.服务器代理</a></li><li class="level-2" data-v-40a3448a><a href="/B_Javascript/60_Ajax.html#六、异步处理方法promise" class="sidebar-link" data-v-40a3448a>六、异步处理方法Promise</a></li><li class="level-3" data-v-40a3448a><a href="/B_Javascript/60_Ajax.html#_1-promise" class="sidebar-link" data-v-40a3448a>1.Promise</a></li><li class="level-3" data-v-40a3448a><a href="/B_Javascript/60_Ajax.html#_2-try-catch" class="sidebar-link" data-v-40a3448a>2.try...catch</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-44bd5a18 data-v-44bd5a18><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-44bd5a18><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-44bd5a18></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-44bd5a18></path></svg></div></div></div>
    <script src="/assets/js/app.37a344aa.js" defer></script><script src="/assets/js/3.27823f6c.js" defer></script><script src="/assets/js/1.cc6167c7.js" defer></script><script src="/assets/js/17.ba0d4562.js" defer></script>
  </body>
</html>
