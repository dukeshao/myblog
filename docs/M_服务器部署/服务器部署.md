---
title: 服务器部署
categories:
- M_服务器部署
date: 2020-07-21 23:20:15
tags:
---

## 下载安装nodeJS

```bash
#下载 nodejs
wget https://nodejs.org/dist/v12.18.2/node-v12.18.2-linux-x64.tar.xz
#将 tar.xz 文件转为 tar 文件
xz -d node-v12.18.2-linux-x64.tar.xz
#执行 tar 解压
tar -xvf node-v12.18.2-linux-x64.tar
#重命名 并移动到 opt 文件下
mv node-v12.18.2-linux-x64 /opt/node
#配置环境变量
vim /etc/profile
#在文件最下方添加一下代码
export NODE_HOME=/usr/local/node  //Node所在路径
export PATH=$NODE_HOME/bin:$PATH
#执行命令使文件生效
source /etc/profile
#查看node环境变量是否生效 - 查看node版本
node -v
```



### 下载安装 mongodb

```bash
#下载 mongdb
wget  https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-rhel70-4.2.5.tgz
#解压
tar -zxvf mongodb-linux-x86_64-rhel70-4.2.5.tgz
#重命名
mv mongodb-linux-x86_64-rhel70-4.2.5.tgz mongodb-4.2
#在mongodb目录下创建data、logs目录和logs/mongodb.log文件
mkdir data logs
vi logs/mongodb.log
#保存退出
:wq
#在mongodb 的bin目录下创建mongodb.conf配置文件
vi mongodb.conf
dbpath=/install/mongodb-4.2/data/db
logpath=/install/mongodb-4.2/logs/mongodb.log
port=27017
fork=true

#环境变量配置
vi /etc/profile
export MONGODB_HOME=/install/mongodb-4.2
export PATH=$PATH:$MONGODB_HOME/bin

#保存后，重启系统配置
source /etc/profile

#进入目录/etc/systemd/system/ 创建 mongodb.service
vi /etc/systemd/system/mongodb.service
#输入以下

[Unit]
Description=High-performance, schema-free document-oriented database
After=network.target

[Service]
User=root
ExecStart=/install/mongodb-4.2/bin/mongod --quiet --config /install/mongodb-4.2/bin/mongodb.conf

[Install]
WantedBy=multi-user.target

#保存，启动并查看进程
sudo systemctl start mongodb
sudo systemctl status mongodb

#让他永久启动
sudo systemctl enable mongodb
```



### 本地上传文件到服务器

```bash
#scp -r 文件本地绝对地址 username@IP:服务器目标文件地址
scp -r /Users/dukeshao/Documents/1000存档/工作区项目/xiaorizi/xiaorizi_houtai/testmongo.zip root@203.195.136.177:/myapp
```



### docker

```bash
yum install python3-pip
#升级 pip3
pip3 install --upgrade pip

#使用 root 权限登录 Centos。确保 yum 包更新到最新。
sudo yum update
#安装需要的软件包， yum-util 提供yum-config-manager功能，另外两个是devicemapper驱动依赖的
sudo yum install -y yum-utils device-mapper-persistent-data lvm2
#设置yum源 新版的 Docker 推荐使用 json 配置文件的方式，默认为 /etc/docker/daemon.json，非默认路径需要修改 dockerd 的 –config-file，在该文件中加入如下内容： 
{ 
"registry-mirrors": ["http://hub-mirror.c.163.com"]
}
#安装 docker
sudo yum install docker
#启动并加入开机启动
sudo systemctl start docker
sudo systemctl enable docker
#拉取 mongo 镜像
docker pull mongo
#启动 mongodb 并映射文件(:是映射文件目录)
docker run -p 27017:27017 -v /install/mongo:/data/db --name mongo_container -d mongo
#进入 mongo 容器，即可操作 mongodb 数据库
docker exec -it mongo_container mongo admin
```



部署 node 接口的 dockerfile

```dockerfile
FROM node:latest
RUN mkdir -p /opt/server
WORKDIR /opt/server
COPY /myapp/xiaorizi_back /opt/server
RUN npm install
EXPOSE 3355
CMD node server.js
```



```bash
#列出所有端口

netstat -ntlp
```

## command not found

```bash
提示bash: ls: command not found，无法使用Linux命令
是因为环境变量PATH被修改了
只需在命令行执行
export PATH=/bin:/usr/bin:$PATH
即可
```

